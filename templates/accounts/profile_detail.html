{% extends "accounts/base.html" %}

{% block content %}
<div class="profile-header">
    <div class="container">
        <div class="profile-info">
            <img src="{{ profile_user.avatar.url|default:'https://via.placeholder.com/128' }}" 
                 alt="{{ profile_user.username }}" 
                 class="profile-avatar">
            <div>
                <h1 class="text-2xl font-bold">{{ profile_user.get_full_name }}</h1>
                <p class="text-gray">@{{ profile_user.username }}</p>
                {% if profile_user.user_type == 'researcher' %}
                    <p>{{ profile_user.field_of_study }} at {{ profile_user.institution }}</p>
                {% endif %}
                
                {% if user.is_authenticated and user != profile_user %}
                    <button class="btn btn-primary mt-4 follow-btn" 
                            data-username="{{ profile_user.username }}">
                        {% if user.is_following %}Unfollow{% else %}Follow{% endif %}
                    </button>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="profile-stats">
    <div class="stat-card">
        <div class="stat-value">{{ polls_created }}</div>
        <div class="stat-label">Polls Created</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ polls_participated }}</div>
        <div class="stat-label">Polls Participated</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ discussions_created }}</div>
        <div class="stat-label">Discussions</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ comments_made }}</div>
        <div class="stat-label">Comments</div>
    </div>
</div>

{% if user_points %}
<div class="mt-8">
    <h2 class="text-xl font-semibold mb-4">Achievements</h2>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        {% for badge in badges %}
            <div class="p-4 bg-white rounded-lg shadow text-center">
                <i class="fas {{ badge.icon }} text-3xl text-primary"></i>
                <h3 class="mt-2 font-medium">{{ badge.name }}</h3>
                <p class="text-sm text-gray">{{ badge.description }}</p>
            </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<script>
document.querySelectorAll('.follow-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
        const username = btn.dataset.username;
        const response = await fetch(`/accounts/follow/${username}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            },
        });
        const data = await response.json();
        btn.textContent = data.is_following ? 'Unfollow' : 'Follow';
    });
});
</script>
{% endblock %}